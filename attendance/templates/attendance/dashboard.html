{% extends "base.html" %}
{% load static %}
{% block title %}Dashboard{% endblock %}
{% block content %}
<h1 class="mb-4">Attendance dashboard</h1>

<div class="row g-4">
  <div class="col-lg-6">
    <canvas id="chart" height="200"></canvas>
  </div>

  <div class="col-lg-6">
    <table id="logTable" class="table table-striped table-sm align-middle">
      <thead class="table-primary">
        <tr><th>Username</th><th>Timestamp</th><th>Latency (ms)</th><th>Verified</th></tr>
      </thead>
      <tbody>
        {% for log in logs_today %}
          <tr>
            <td>{{ log.student.user.username }}</td>
            <td>{{ log.timestamp|date:"Y-m-d H:i:s" }}</td>
            <td>{{ log.latency_ms }}</td>
            <td>{{ log.verified|yesno:"✅,❌" }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
    <a href="{% url 'export_today_csv' %}" class="btn btn-outline-secondary btn-sm mt-2">Download CSV</a>
  </div>
</div>

<!-- Chart & DataTable scripts -->
<script src="{% static 'attendance/js/chart.umd.js' %}"></script>
<script defer src="https://cdn.jsdelivr.net/npm/simple-datatables@9.0.0/dist/umd/simple-datatables.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/simple-datatables@9.0.0/dist/style.css" rel="stylesheet">
<script defer src="{% static 'attendance/js/dashboard_table.js' %}"></script>
<script>
const ctx=document.getElementById("chart");
new Chart(ctx,{type:"bar",
  data:{labels:{{ labels|safe }},datasets:[{data:{{ values|safe }},label:"Scans",borderWidth:1}]},
  options:{scales:{y:{beginAtZero:true}}}
});
</script>
{% endblock %}
